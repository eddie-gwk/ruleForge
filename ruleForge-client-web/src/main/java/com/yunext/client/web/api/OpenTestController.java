package com.yunext.client.web.api;

import com.yunext.api.service.core.ChainExecuteService;
import com.yunext.api.service.reload.RuleReloadService;
import com.yunext.api.vo.ApiResultVo;
import org.apache.dubbo.config.annotation.DubboReference;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

/**
 * @author ：qianjb [qianjb@hadlinks.com]
 * @description ：开放测试
 * @date ：Created in 2024/7/8 10:29
 */
@RestController
@RequestMapping(value = "/api/web/open/test")
public class OpenTestController {

    @DubboReference
    private RuleReloadService ruleReloadService;

    @DubboReference
    private ChainExecuteService chainExecuteService;


    @PostMapping(value = "/execute")
    public ApiResultVo<?> execute(String chain, String rule) {
        ruleReloadService.reload(chain, rule);
        chainExecuteService.executeOnce(chain);
        return ApiResultVo.success();
    }
}
